        <!-- Websocket server and client modified from -->
<!-- https://github.com/sanwebe/Chat-Using-WebSocket-and-PHP-Socket -->
<div class="card direct-chat direct-chat-warning">
    <div class="card-header">
        <h3 class="card-title">Global Chat</h3>
        <div class="card-tools">
            <span id="unseen-messages" title="3 New Messages" class="badge text-bg-warning">3</span>
            
            <button type="button" class="btn btn-tool" data-lte-toggle="card-collapse">
                <i data-lte-icon="expand" class="bi bi-plus-lg"></i>
                <i data-lte-icon="collapse" class="bi bi-dash-lg"></i>
            </button>
            
            <button id="expand-widget-chat" class="btn btn-tool">
                <i class="bi bi-chevron-bar-right"></i>
            </button>
            
            <button type="button" class="btn btn-tool" data-lte-toggle="card-remove">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
    </div>

    <div class="card-body">
        <div id="chat-message-container" name="chat-message-container" class="direct-chat-messages">

        </div>
    </div>
    
    <div class="card-footer">
        <!--<form id="gc-chat-form" name="gc-chat-form" action="/dashboard" method="post">-->
            <div class="input-group">
                <input id="gc-chat-message" name="gc-chat-message" type="text" placeholder="Type Message ..." class="form-control">
                <span class="input-group-append">
                    <input id="gc-send-button" name="gc-send-button" type="submit" class="btn btn-warning" value="Send" />
                </span>
            </div>
        <!--</form>-->
    </div>
</div>

<script>
    /*var wsUri = "ws://127.0.0.1:8090/system/gc/server.php";
    websocket = new WebSocket(wsUri);
    var msgBox = document.getElementById('chat-message-container');
    console.log(websocket);

    websocket.onopen = function(event) {
        $('#chat-message-container').append('User joined chat');
    };

    websocket.onmessage = function(event) {
		var response 		= JSON.parse(event.data); //PHP sends Json data
        var res_type 		= response.type; //message type
		var user_message 	= response.message; //message text
		var user_name 		= response.name; //user name

        var datez = new Date().toDateString();
        var timez = new Date().toLocaleTimeString();

        var datentime = datez + " " + timez;
        
        

        out = '<div class="direct-chat-msg"><div class="direct-chat-infos clearfix"><span class="direct-chat-name float-start">' + user_name + '</span><span class="direct-chat-timestamp float-end">' + datentime + '</span></div><img class="direct-chat-img" src="<?php echo $character->get_avatar(); ?>" alt="Message User Image"><div class="direct-chat-text">' + response.message + '</div></div>'

        switch(res_type){
			case 'usermsg':
            $('#chat-message-container').append(out);
				break;
			case 'system':
            $('#chat-message-container').append('<div style="color:#bbbbbb">' + user_message + '</div>');
				break;
		}
		document.getElementById('chat-message-container').scrollTop = document.getElementById('chat-message-container').scrollHeight; //scroll message 
	};

	//Message send button
	$("#gc-send-button").click(function() {
		send_message();
	});
	
	//User hits enter key 
	$(document).on("keydown", function(event) {
	    if (event.which == 13) {
		    send_message();
	    }
	});

    function send_message() {
		var message_input = $('#gc-chat-message');
		var name_input = "<?php echo $account->get_email(); ?>";
		
		if(message_input.val() == ""){ //emtpy message?
			return;
		}

		//prepare json data
		var msg = {
			message: message_input.val(),
			name: name_input
		};
		//convert and send data to server
		websocket.send(JSON.stringify(msg));	
		message_input.val(''); //reset message input
	}
    //websocket.onclose =
    //websocket.onerror = 



    /*
*/
</script>